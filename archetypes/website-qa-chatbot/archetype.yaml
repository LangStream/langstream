#
# Copyright DataStax, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

archetype:
   title: "Website QA Chatbot"
   labels:
     - qa
     - chat-bot
     - website
     - astra
   description: "This archetype is a chatbot that answers questions from a website. It uses a pre-trained model from OpenAI to compute embeddings for the questions and then uses a Cassandra database to store the answers."
   icon: "https://raw.githubusercontent.com/datastax/management-api-for-apache-cassandra/master/docs/images/website-qa-chatbot.png"
   sections:
     - title: Website
       description: "Define the website to crawl"
       parameters:
         - name: "website-url"
           label: "Website URL"
           description: "The URL of the website to crawl"
           type: "strings-array"
           subtype: "url"
           required: true
           binding: "globals.website.urls"
           default:
             - "https://docs.langstream.ai/"
             - "https://langstream.ai/"
         - name: "website-crawler-depth"
           label: "Crawler depth"
           description: "Maximum depth of the crawler"
           type: "integer"
           binding: "globals.website.max-depth"
           default: 10
           required: false
     - title: OpenAI parameters
       description: "This archetype uses a pre-trained model from OpenAI to compute embeddings for the questions. You need to provide the name of the model deployment."
       parameters:
         - name: "embeddings-model"
           label: "Embeddings model"
           description: "The name of the model deployment from OpenAI."
           type: "string"
           default: ""
           required: true
           binding: "secrets.open-ai.embeddings-model"
         - name: "access-key"
           label: "Access key"
           description: "The access key for the OpenAI API."
           type: "string"
           required: true
           binding: "secrets.open-ai.access-key"
         - name: "chat-completion-model"
           label: "Chat completion model"
           description: "The name of the model deployment from OpenAI."
           type: "string"
           required: true
           binding: "secrets.open-ai.chat-completions-model"
     - title: Prompt
       description: "Here you can define the prompt to send to the LLM"
       parameters:
          - name: "llm-prompt"
            label: "Prompt"
            description: "This is the template to send to the LLM"
            type: "prompt"
            subtype: "openai-prompt" # each LLM has its own way of defining the prompt
            binding: "globals.llm.prompt"
            default: |            
              - role: system
                content: |
                    An user is going to perform a questions, The documents below may help you in answering to their questions.
                    Please try to leverage them in your answer as much as possible.
                    Take into consideration that the user is always asking questions about the LangStream project.
                    If you provide code or YAML snippets, please explicitly state that they are examples.
                    Do not provide information that is not related to the LangStream project.
              
                    Documents:
                    {{# value.related_documents }}
                    {{ text}}
                    {{/ value.related_documents }}
              - role: user
                content: "{{ value.question }}"
            required: true
     - title: Astra DB parameters
       description: "This application uses a AstraDB database to store the answers. You need to provide the connection information for the database."
       parameters:
          - name: "astra-database"
            label: "Database"
            description: "The name of the Astra DB database"
            type: "string"
            subtype: "astra-database"
            binding: "secrets.astra.database"
            required: true
          - name: "astra-client-id"
            label: "Client ID"
            description: "The client ID for the Astra DB database"
            type: "string"
            subtype: "astra-client-id"
            required: true
            binding: "secrets.astra.clientId"
          - name: "astra-client-secret"
            label: "Client secret"
            description: "The client secret for the Astra DB database"
            type: "string"
            subtype: "astra-client-secret"
            required: true
            binding: "secrets.astra.secret"
          - name: "astra-token"
            label: "Token"
            description: "The token for the Astra DB database"
            type: "string"
            subtype: "astra-token"
            binding: "secrets.astra.token"
            required: true
     - title: S3 Bucket parameters
       description: "The crawler uses an S3 bucket to store the state of the crawler. You need to provide the connection information for the S3 bucket."
       parameters:
         - name: "s3-bucket"
           label: "Bucket name"
           description: "The name of the S3 bucket"
           type: "string"
           subtype: "s3-bucket"
           binding: "secrets.s3.bucket-name"
           required: true
         - name: "s3-access-key"
           label: "S3 Access key"
           description: "The access key for the S3 bucket"
           type: "string"
           subtype: "s3-access-key"
           binding: "secrets.s3.access-key"
           required: true
     - title: Kafka parameters
       description: "LangStream uses Kafka to connect the agents"
       parameters:
         - name: "kafka-bootstrap-servers"
           label: "Kafka bootstrap servers"
           description: "The connection string to the broker"
           type: "string"
           subtype: "kafka-bootstrap-servers"
           binding: "secrets.kafka.bootstrap-servers"
           required: true
         - name: "kafka-username"
           label: "Username"
           description: "The username for the Kafka broker"
           type: "string"
           subtype: "kafka-username"
           binding: "secrets.kafka.username"
           required: true
         - name: "kafka-password"
           label: "Password"
           description: "The password for the Kafka broker"
           type: "password"
           subtype: "kafka-password"
           binding: "secrets.kafka.password"
           required: true
